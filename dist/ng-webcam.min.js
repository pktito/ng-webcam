!function(){"use strict";function n(){function n(n,e){return['<div class="ng-webcam no-overlay" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.webcamLive === true && vm.config.countdown > 0 && vm.counter > 0" id="ng-webcam-counter">{{vm.counter}}</span>','<img ng-show="vm.webcamLive === true" id="ng-webcam-overlay" src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},window.localStorage&&window.localStorage.setItem("visited","1"),angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),angular.isUndefined(l.config.flipHoriz)&&(l.config.flipHoriz=!1),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:l.config.flipHoriz}),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY291bnRkb3duIiwiZmxpcEhvcml6IiwiY29uZmlndXJlTGlzdGVuZXJzIiwiY29uZmlndXJlIiwid2ViY2FtTGl2ZSIsIldlYmNhbSIsInJlc2V0Iiwid2ViY2FtTG9hZGVkIiwiaXNEZWZpbmVkIiwic25hcHNob3RUaW1lciIsImNhbmNlbCIsInVuZGVmaW5lZCIsImNvdW50ZG93blRpbWVyIiwiY291bnRlciIsInNodXR0ZXJVcmwiLCJzb3VuZCIsIkF1ZGlvIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsInNyYyIsInNwbGl0Iiwic2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0X3dpZHRoIiwiZGVzdF9oZWlnaHQiLCJmb3JjZV9mbGFzaCIsImltYWdlX2Zvcm1hdCIsImpwZWdfcXVhbGl0eSIsImZsaXBfaG9yaXoiLCJmbGFzaE5vdERldGVjdGVkVGV4dCIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImF0dGFjaCIsIm9uIiwiJGFwcGx5Iiwib25Mb2FkIiwib25MaXZlIiwiZXJyIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXVCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsaUhBQ0EsbUlBQ0EsOEZBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLE9BQUFDLGNBQUFELE9BQUFDLGFBQUFDLFFBQUEsVUFBQSxLQUNBQyxRQUFBQyxZQUFBTixFQUFBQyxPQUFBTSxlQUFBUCxFQUFBQyxPQUFBTSxZQUFBLFFBQ0FGLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFPLGdCQUFBUixFQUFBQyxPQUFBTyxhQUFBLFFBQ0FILFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFRLGVBQUFULEVBQUFDLE9BQUFRLFlBQUEsS0FDQUosUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVMsZ0JBQUFWLEVBQUFDLE9BQUFTLGFBQUEsS0FDQUwsUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVUsU0FBQVgsRUFBQUMsT0FBQVUsTUFBQSxHQUNBTixRQUFBQyxZQUFBTixFQUFBQyxPQUFBVyxTQUFBWixFQUFBQyxPQUFBVyxNQUFBLEdBQ0FQLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFZLGFBQUFiLEVBQUFDLE9BQUFZLFVBQUEsR0FDQVIsUUFBQUMsWUFBQU4sRUFBQUMsT0FBQWEsYUFBQWQsRUFBQUMsT0FBQWEsV0FBQSxHQUVBQyxJ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QUFBWCxFQUFBQyxPQUFBVyxTQUVBLElBQUEsSUFJQSxRQUFBd0QsS0FDQWxELE9BQUE4QixPQUFBLHdCQUdBLFFBQUFxQixLQUNBekUsSUFqTEEsR0FDQWdDLEdBQUFOLEVBQUFHLEVBREF6QixFQUFBc0UsS0FFQVYsSUFDQTVELEdBQUFvQixjQUFBLEVBQ0FwQixFQUFBaUIsWUFBQSxFQUNBakIsRUFBQTBCLFFBQUEsRUFDQTFCLEVBQUFOLEtBQUFBLEVBQ0FNLEVBQUFKLFFBQUFBLEVBV0FFLEVBQUFILElBQUEsbUJBQUF1RSxHQVdBcEUsRUFBQUgsSUFBQSxjQUFBeUUsR0FXQXRFLEVBQUFILElBQUEsZUFBQTBFLEdBNUVBLEdBQUFFLElBQ0FDLFNBQUEsSUFDQXJGLFNBQUFBLEVBQ0FJLEtBQUFBLEVBQ0FrRixrQkFBQSxFQUNBQyxXQUFBN0UsRUFDQThFLGFBQUEsS0FDQW5GLE9BQ0FTLE9BQUEsSUFDQWdFLGtCQUFBLElBQ0FYLFFBQUEsSUFDQUgsT0FBQSxJQUNBVSxrQkFBQSxJQUNBVCxPQUFBLEtBNE1BLE9BekxBdkQsR0FBQStFLFNBQUEsU0FBQSxhQXlMQUwsRUFoUEFsRSxRQUFBd0UsT0FBQSxnQkFBQU4sVUFBQSxXQUFBckYsR0FDQUEsRUFBQTBGIiwiZmlsZSI6Im5nLXdlYmNhbS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ25nLXdlYmNhbScsIFtdKS5kaXJlY3RpdmUoJ25nV2ViY2FtJywgbmdXZWJjYW0pO1xyXG4gICAgbmdXZWJjYW0uJGluamVjdCA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogIEBuZ2RvYyBEaXJlY3RpdmVcclxuICAgICAqICBAbmFtZSBuZy13ZWJjYW1cclxuICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAqXHJcbiAgICAgKiAgRGlyZWN0aXZlIGZvciBjYXB0dXJpbmcgaW1hZ2VzIGZyb20geW91ciBjb21wdXRlcidzIGNhbWVyYSwgYW5kIGRlbGl2ZXJ5IHRoZW4gdG8geW91IGFzIGRhdGEgdXJpXHJcbiAgICAgKlxyXG4gICAgICogIEB1c2FnZVxyXG4gICAgICogIGBgYGh0bWxcclxuICAgICAqICA8bmctd2ViY2FtXHJcbiAgICAgKiAgICBjb25maWc9XCJ2bS5jb25maWdcIlxyXG4gICAgICogICAgb24tZXJyb3I9XCJ2bS5vbkVycm9yKGVycilcIlxyXG4gICAgICogICAgb24tbG9hZD1cInZtLm9uTG9hZCgpXCJcclxuICAgICAqICAgIG9uLWxpdmU9XCJ2bS5vbkxpdmUoKVwiXHJcbiAgICAgKiAgICBvbi1jYXB0dXJlLXByb2dyZXNzPVwidm0ub25DYXB0dXJlUHJvZ3Jlc3Moc3JjLCBwcm9ncmVzcylcIlxyXG4gICAgICogICAgb24tY2FwdHVyZS1jb21wbGV0ZT1cInZtLm9uQ2FwdHVyZUNvbXBsZXRlKHNyYylcIj5cclxuICAgICAqICA8L25nLXdlYmNhbT5cclxuICAgICAqICBgYGBcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gbmdXZWJjYW0oKSB7XHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBuZ1dlYmNhbUNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZzogJz0nLFxyXG4gICAgICAgICAgICAgICAgb25DYXB0dXJlQ29tcGxldGU6ICcmJyxcclxuICAgICAgICAgICAgICAgIG9uRXJyb3I6ICcmJyxcclxuICAgICAgICAgICAgICAgIG9uTG9hZDogJyYnLFxyXG4gICAgICAgICAgICAgICAgb25DYXB0dXJlUHJvZ3Jlc3M6ICcmJyxcclxuICAgICAgICAgICAgICAgIG9uTGl2ZTogJyYnXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB0ZW1wbGF0ZShlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICByZXR1cm4gWyc8ZGl2IGNsYXNzPVwibmctd2ViY2FtIG5vLW92ZXJsYXlcIiBuZy1jbGFzcz1cIntcXCduby1vdmVybGF5XFwnIDogdm0uY291bnRlciA9PT0gMCB8fCB2bS5jb25maWcuY291bnRkb3duID09PSAwfVwiPicsXHJcbiAgICAgICAgICAgICAgICAnPHNwYW4gbmctc2hvdz1cInZtLndlYmNhbUxpdmUgPT09IHRydWUgJiYgdm0uY29uZmlnLmNvdW50ZG93biA+IDAgJiYgdm0uY291bnRlciA+IDBcIiBpZD1cIm5nLXdlYmNhbS1jb3VudGVyXCI+e3t2bS5jb3VudGVyfX08L3NwYW4+JyxcclxuICAgICAgICAgICAgICAgICc8aW1nIG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlXCIgaWQ9XCJuZy13ZWJjYW0tb3ZlcmxheVwiIHNyYz1cInt7dm0uY29uZmlnLm92ZXJsYXl9fVwiIC8+JyxcclxuICAgICAgICAgICAgICAgICc8ZGl2IGlkPVwibmctd2ViY2FtLWNvbnRhaW5lclwiPjwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICAnPC9kaXY+J10uam9pbignJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICBjdHJsLmluaXQoKTtcclxuICAgICAgICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGN0cmwuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5nV2ViY2FtQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGludGVydmFsJ107XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG5nV2ViY2FtQ29udHJvbGxlcigkc2NvcGUsICRpbnRlcnZhbCkge1xyXG4gICAgICAgICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cclxuICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIHNvdW5kLCBzbmFwc2hvdFRpbWVyLCBjb3VudGRvd25UaW1lcjtcclxuICAgICAgICAgICAgdmFyIGltYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5jb3VudGVyID0gMztcclxuICAgICAgICAgICAgdm0uaW5pdCA9IGluaXQ7XHJcbiAgICAgICAgICAgIHZtLmRlc3Ryb3kgPSBkZXN0cm95O1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogIEBuZ2RvYyBsaXN0ZW5lclxyXG4gICAgICAgICAgICAgKiAgQG5hbWUgbmdXZWJjYW1fY2FwdHVyZVxyXG4gICAgICAgICAgICAgKiAgQGRlc2NyaXB0aW9uXHJcbiAgICAgICAgICAgICAqXHJcbiAgICAgICAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FwdHVyZSB1c2VyIGFjdGlvblxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgQHVzYWdlXHJcbiAgICAgICAgICAgICAqICBgJHNjb3BlLiRicm9hZGNhc3QoJ25nV2ViY2FtX2NhcHR1cmUnKTtgXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9jYXB0dXJlJywgb25XZWJjYW1DYXB0dXJlKTtcclxuICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcclxuICAgICAgICAgICAgICogIEBuYW1lIG5nV2ViY2FtX29uXHJcbiAgICAgICAgICAgICAqICBAZGVzY3JpcHRpb25cclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogIExpc3RlbmVyIGZvciBjYW1lcmEgb24gdXNlciBhY3Rpb25cclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogIEB1c2FnZVxyXG4gICAgICAgICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9vbicpO2BcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29uJywgb25XZWJjYW1Pbik7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiAgQG5nZG9jIGxpc3RlbmVyXHJcbiAgICAgICAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vZmZcclxuICAgICAgICAgICAgICogIEBkZXNjcmlwdGlvblxyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvZmYgdXNlciBhY3Rpb25cclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogIEB1c2FnZVxyXG4gICAgICAgICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9vZmYnKTtgXHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCduZ1dlYmNhbV9vZmYnLCBvbldlYmNhbU9mZik7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgICAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhbFN0b3JhZ2UpIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndmlzaXRlZCcsICcxJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VyV2lkdGgpKSB2bS5jb25maWcudmlld2VyV2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9ICdhdXRvJztcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRXaWR0aCkpIHZtLmNvbmZpZy5vdXRwdXRXaWR0aCA9IDMyMDtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQpKSB2bS5jb25maWcub3V0cHV0SGVpZ2h0ID0gMjQwO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5zaG90cykpIHZtLmNvbmZpZy5zaG90cyA9IDE7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkgdm0uY29uZmlnLmNvdW50ZG93biA9IDA7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuZmxpcEhvcml6KSkgdm0uY29uZmlnLmZsaXBIb3JpeiA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyZUxpc3RlbmVycygpO1xyXG4gICAgICAgICAgICAgICAgY29uZmlndXJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGRlc3Ryb3koKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ud2ViY2FtTGl2ZSkgV2ViY2FtLnJlc2V0KCk7XHJcbiAgICAgICAgICAgICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChzbmFwc2hvdFRpbWVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoc25hcHNob3RUaW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgc25hcHNob3RUaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChjb3VudGRvd25UaW1lcikpIHtcclxuICAgICAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGNvdW50ZG93blRpbWVyKTtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudGRvd25UaW1lciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmNvdW50ZXIgPSAzO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5zaHV0dGVyVXJsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNvdW5kID0gbmV3IEF1ZGlvKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc291bmQuYXV0b3BsYXkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvRmlyZWZveC8pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdW5kLnNyYyA9IHZtLmNvbmZpZy5zaHV0dGVyVXJsLnNwbGl0KCcuJylbMF0gKyAnLm9nZyc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc291bmQuc3JjID0gdm0uY29uZmlnLnNodXR0ZXJVcmw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgV2ViY2FtLnNldCh7XHJcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHZtLmNvbmZpZy52aWV3ZXJXaWR0aCxcclxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzdF93aWR0aDogdm0uY29uZmlnLm91dHB1dFdpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc3RfaGVpZ2h0OiB2bS5jb25maWcub3V0cHV0SGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgICAgIGZvcmNlX2ZsYXNoOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBpbWFnZV9mb3JtYXQ6ICdqcGVnJyxcclxuICAgICAgICAgICAgICAgICAgICBqcGVnX3F1YWxpdHk6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICBmbGlwX2hvcml6OiB2bS5jb25maWcuZmxpcEhvcml6XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFdlYmNhbS5zZXRTV0ZMb2NhdGlvbih2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBXZWJjYW0uYXR0YWNoKCcjbmctd2ViY2FtLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVMaXN0ZW5lcnMoKSB7XHJcbiAgICAgICAgICAgICAgICBXZWJjYW0ub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLndlYmNhbUxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxvYWQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5vbkxvYWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBXZWJjYW0ub24oJ2xpdmUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLndlYmNhbUxpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodm0ub25MaXZlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ub25MaXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgV2ViY2FtLm9uKCdlcnJvcicsIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodm0ub25FcnJvcikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ub25FcnJvcih7ZXJyOiBlcnJ9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2FwdHVyZShpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc291bmQucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID09PSAodm0uY29uZmlnLnNob3RzIC0gMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24gKGRhdGFfdXJpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VzW2luZGV4XSA9IGRhdGFfdXJpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA8ICh2bS5jb25maWcuc2hvdHMgLSAxKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVQcm9ncmVzcykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4ICsgMSkgKiAxMDApIC8gdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ub25DYXB0dXJlUHJvZ3Jlc3Moe3NyYzogZGF0YV91cmksIHByb2dyZXNzOiBwcm9ncmVzc30pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMgLSAxKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkNhcHR1cmVDb21wbGV0ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZtLm9uQ2FwdHVyZUNvbXBsZXRlKHtzcmM6IGltYWdlc30pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvbldlYmNhbUNhcHR1cmUoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuY291bnRkb3duKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgc25hcHNob3RUaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZG93blRpbWVyICE9PSB1bmRlZmluZWQpIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb3VudGVyID0gMztcclxuICAgICAgICAgICAgICAgICAgICBjb3VudGRvd25UaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNvdW50ZXIgPSB2bS5jb3VudGVyIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmNvdW50ZXIgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3VudGRvd25UaW1lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoY291bnRkb3duVGltZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNuYXBzaG90VGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmUoY291bnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCAodm0uY29uZmlnLmRlbGF5ICogMTAwMCksIHZtLmNvbmZpZy5zaG90cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwLCAzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gb25XZWJjYW1PbigpIHtcclxuICAgICAgICAgICAgICAgIFdlYmNhbS5hdHRhY2goJyNuZy13ZWJjYW0tY29udGFpbmVyJyk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG9uV2ViY2FtT2ZmKCkge1xyXG4gICAgICAgICAgICAgICAgZGVzdHJveSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG4gICAgfVxyXG59KSgpOyJdfQ==
